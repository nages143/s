Sub GenerateStudentSubjects()
    Dim wsStudents As Worksheet, wsSubjects As Worksheet, wsOutput As Worksheet
    Dim student As Range
    Dim lastStudentRow As Long, lastSubjectCol As Long
    Dim outputRow As Long
    Dim i As Integer
    
    ' Define worksheets
    Set wsStudents = ThisWorkbook.Sheets("Students") ' Change if needed
    Set wsSubjects = ThisWorkbook.Sheets("Subjects") ' Change if needed
    
    ' Create or clear output sheet
    On Error Resume Next
    Set wsOutput = ThisWorkbook.Sheets("Student_Subjects")
    If wsOutput Is Nothing Then
        Set wsOutput = ThisWorkbook.Sheets.Add
        wsOutput.Name = "Student_Subjects"
    Else
        wsOutput.Cells.Clear
    End If
    On Error GoTo 0
    
    ' Headers
    wsOutput.Cells(1, 1).Value = "StudentId"
    wsOutput.Cells(1, 2).Value = "Subject"
    wsOutput.Cells(1, 3).Value = "Result"

    outputRow = 2

    ' Get last row of students
    lastStudentRow = wsStudents.Cells(Rows.Count, 1).End(xlUp).Row

    ' Get last column of subjects dynamically
    lastSubjectCol = wsSubjects.Cells(1, Columns.Count).End(xlToLeft).Column

    ' Loop through each student
    For Each student In wsStudents.Range("A2:A" & lastStudentRow)
        ' Loop through each subject column dynamically
        For i = 1 To lastSubjectCol
            wsOutput.Cells(outputRow, 1).Value = student.Value
            wsOutput.Cells(outputRow, 2).Value = wsSubjects.Cells(1, i).Value ' Subject Name
            wsOutput.Cells(outputRow, 3).Value = wsSubjects.Cells(2, i).Value ' Result
            outputRow = outputRow + 1
        Next i
    Next student

    MsgBox "Student-Subject sheet created dynamically!", vbInformation
End Sub