Sub MergeStudentsWithSubjects()
    Dim wsStudents As Worksheet, wsSubjects As Worksheet, wsOutput As Worksheet
    Dim student As Range, subjectRow As Range
    Dim lastStudentRow As Long, lastSubjectRow As Long
    Dim outputRow As Long
    
    ' Define worksheets
    Set wsStudents = ThisWorkbook.Sheets("Students") ' Change if needed
    Set wsSubjects = ThisWorkbook.Sheets("Subjects") ' Change if needed
    
    ' Create or clear output sheet
    On Error Resume Next
    Set wsOutput = ThisWorkbook.Sheets("expected_result")
    If wsOutput Is Nothing Then
        Set wsOutput = ThisWorkbook.Sheets.Add
        wsOutput.Name = "expected_result"
    Else
        wsOutput.Cells.Clear
    End If
    On Error GoTo 0
    
    ' Copy headers from Subjects Sheet and add StudentId as the first column
    wsOutput.Cells(1, 1).Value = "StudentId"
    wsSubjects.Rows(1).Copy wsOutput.Cells(1, 2)
    
    outputRow = 2

    ' Get last row of students and subjects
    lastStudentRow = wsStudents.Cells(Rows.Count, 1).End(xlUp).Row
    lastSubjectRow = wsSubjects.Cells(Rows.Count, 1).End(xlUp).Row

    ' Loop through each student
    For Each student In wsStudents.Range("A2:A" & lastStudentRow)
        ' Loop through each row in Subjects Sheet
        For Each subjectRow In wsSubjects.Range("A2:A" & lastSubjectRow)
            wsOutput.Cells(outputRow, 1).Value = student.Value ' StudentId
            wsSubjects.Range("A" & subjectRow.Row & ":D" & subjectRow.Row).Copy
            wsOutput.Cells(outputRow, 2).PasteSpecial Paste:=xlPasteValues
            outputRow = outputRow + 1
        Next subjectRow
    Next student

    Application.CutCopyMode = False
    MsgBox "Expected result sheet created successfully!", vbInformation
End Sub